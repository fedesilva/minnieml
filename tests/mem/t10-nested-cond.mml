// T10: Nested conditional ownership (all-heap variant)
// Tests that ownership tracking handles nested if/else correctly.
// Each call allocates on exactly one branch path; freed at scope end.
// NOTE: mixed variant (heap+literal branches) is broken â€” see tracking.md

fn all_heap(a: Int, b: Int): Unit =
  let s = if a > 0 then
    if b > 0 then
      int_to_str a
    else
      int_to_str b
    end
  else
    int_to_str (a + b)
  end;
  println s
;

// T11: Conditional consumption of an owned binding
// One branch passes to consuming ~param, other just borrows.
fn consume(~s: String): Unit = println s;

fn test_cond_consume(flag: Bool): Unit =
  let s = int_to_str 1;
  if flag then
    consume s
  else
    println s
  end
;

fn run_all_heap(i: Int): Unit =
  if i > 0 then
    all_heap i (i - 50);
    run_all_heap (i - 1)
  end
;

fn run_cond_consume(i: Int): Unit =
  if i > 0 then
    test_cond_consume true;
    test_cond_consume false;
    run_cond_consume (i - 1)
  end
;

fn main(): Unit =
  println "T10: nested conditional (all-heap)...";
  run_all_heap 100;
  println "T11: conditional consumption...";
  run_cond_consume 100;
  println "T10/T11 passed!"
;
