#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat >&2 <<'EOF'
Usage: gh-issue-list [--repo <repo>] [--state <open|closed|all>] [--label <label>] [--limit <n>]
Example: gh-issue-list --repo fedesilva/minnieml --state open --label bug --limit 100
EOF
}

repo="fedesilva/minnieml"
state="open"
label=""
limit="50"

while [[ $# -gt 0 ]]; do
  case "$1" in
    --repo)
      repo="${2:-}"
      shift 2
      ;;
    --state)
      state="${2:-}"
      shift 2
      ;;
    --label)
      label="${2:-}"
      shift 2
      ;;
    --limit)
      limit="${2:-}"
      shift 2
      ;;
    -h|--help)
      usage
      exit 0
      ;;
    *)
      echo "Unknown option: $1" >&2
      usage
      exit 1
      ;;
  esac
done

cmd=(gh issue list --repo "$repo" --state "$state" --limit "$limit" --json number,title,state,url,labels,assignees)
if [[ -n "$label" ]]; then
  cmd+=(--label "$label")
fi

"${cmd[@]}"
